<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Repo Explorer â€” VSCode-style</title>

<!-- External libs -->
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<style>
  :root{
    --bg: #0f1720;
    --panel-bg: #0b1220;
    --muted: #9aa4b2;
    --accent: #42b983;
    --card: #0b1226;
    --glass: rgba(255,255,255,0.03);
    --text: #e6eef6;
  }
  :root.light{
    --bg: #f6f8fa;
    --panel-bg: #ffffff;
    --muted: #6b7280;
    --accent: #0366d6;
    --card: #ffffff;
    --glass: rgba(0,0,0,0.03);
    --text: #111827;
  }

  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  body{background:var(--bg); color:var(--text); display:flex; height:100vh; overflow:hidden;}

  .app { display:grid; grid-template-columns:320px 1fr 420px; gap:18px; width:100%; padding:18px; box-sizing:border-box; }

  .sidebar { background:var(--card); border-radius:12px; padding:12px; display:flex; flex-direction:column; overflow:auto; }
  .brand { display:flex; align-items:center; gap:10px; padding:8px 6px; margin-bottom:6px; }
  .logo { width:36px; height:36px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:700; background:linear-gradient(135deg,var(--accent),#00b894); color:white; }
  .repo-name { font-weight:700; color:var(--text); }
  .repo-meta { font-size:12px; color:var(--muted); margin-top:2px; }

  .sidebar-controls { display:flex; gap:8px; margin:10px 0; }
  .btn { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--text); padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:600; font-size:13px; }
  .btn.primary { background:linear-gradient(90deg,var(--accent),#00b894); color:white; border:none; }
  .small { padding:6px 8px; font-size:13px }

  .tree { margin-top:6px; padding-bottom:18px; }
  .tree ul { list-style:none; margin:0; padding-left:6px; }
  .tree-item { padding:8px 10px; border-radius:8px; display:flex; align-items:center; gap:8px; cursor:pointer; color:var(--text); }
  .tree-item:hover { background:var(--glass); }
  .folder { font-size:18px; color:var(--accent); }
  .file { font-size:16px; color:var(--muted); }

  .main { background:transparent; display:flex; flex-direction:column; }
  .topbar { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
  .search-box { display:flex; gap:8px; align-items:center; width:100%; }
  .search { flex:1; display:flex; align-items:center; gap:8px; padding:10px 12px; border-radius:10px; background:var(--card); border:1px solid rgba(255,255,255,0.04); }
  .search input { width:100%; background:transparent; border:none; outline:none; color:var(--text); font-size:15px; }

  .panel { background:var(--card); border-radius:12px; padding:14px; flex:1; overflow:auto; }

  .results { display:flex; flex-direction:column; gap:8px; }
  .result { background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-radius:8px; padding:10px; display:flex; gap:10px; align-items:center; cursor:pointer; }
  .result:hover { background:var(--glass); }
  .r-left { width:36px; text-align:center; font-size:18px; color:var(--accent); }
  .r-body { flex:1; }
  .r-name { font-weight:600; color:var(--text); }
  .r-path { font-size:13px; color:var(--muted); margin-top:4px; }
  .highlight { background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); padding:2px 6px; border-radius:4px; color:var(--accent); }

  .preview { background:var(--card); border-radius:12px; padding:16px; overflow:auto; height:100%; display:flex; flex-direction:column; }
  .controls { display:flex; gap:8px; margin-bottom:8px; align-items:center; }
  .muted { color:var(--muted); font-size:13px; }

</style>
</head>
<body>

<div class="app">

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <div class="logo">R</div>
      <div>
        <div class="repo-name" id="repoTitle">owner/repo</div>
        <div class="repo-meta">Repository Explorer</div>
      </div>
    </div>
    <div class="sidebar-controls">
      <button class="btn small" id="refreshBtn">Refresh</button>
      <button class="btn small" id="collapseAll">Collapse</button>
      <button class="btn primary small" id="openAll">Expand</button>
    </div>
    <div class="tree" id="fileTree">
      <div class="muted">Loading treeâ€¦</div>
    </div>
  </aside>

  <!-- Middle -->
  <main class="main">
    <div class="topbar">
      <div class="search-box">
        <div class="search">
          <input id="globalSearch" placeholder="Search files/folders..." />
        </div>
        <button class="btn small" id="clearSearch">Clear</button>
      </div>
    </div>
    <div class="panel" id="resultsPanel">
      <div class="results" id="resultsList"></div>
    </div>
  </main>

  <!-- Right -->
  <aside class="preview" id="previewPanel">
    <div class="controls">
      <div>
        <strong id="previewTitle">Select a file</strong>
        <div class="muted" id="previewPath">Path will appear here</div>
      </div>
      <div style="margin-left:auto;">
        <button class="btn small" id="openRaw" style="display:none">Open raw</button>
      </div>
    </div>
    <div id="previewContent" class="content-area" style="flex:1; overflow:auto;">
      <div class="muted">Preview will appear here when you select a file.</div>
    </div>
  </aside>

</div>

<script>
let token = localStorage.getItem("gh_token");
if(!token){
  token = prompt("Enter GitHub PAT to avoid rate limits:");
  if(token) localStorage.setItem("gh_token", token);
}
function authFetch(url, opts={}){ opts.headers = {...(opts.headers||{}), ...(token?{Authorization:`token ${token}`}: {})}; return fetch(url, opts); }

const owner="sheik195", repo="docsify";
const apiBase=`https://api.github.com/repos/${owner}/${repo}`;
const contentsBase=`${apiBase}/contents`;

let repoTree=[], flatFiles=[], fuse=null;

document.getElementById('repoTitle').innerText=`${owner}/${repo}`;

async function loadRepoRecursive(){
  const container=document.getElementById('fileTree');
  container.innerHTML='Loadingâ€¦';
  flatFiles=[];

  async function fetchFolder(path){
    const res=await authFetch(path?`${contentsBase}/${encodeURIComponent(path)}`:contentsBase);
    const items=await res.json();
    for(const f of items){
      if(f.type==='dir') await fetchFolder(f.path);
      else flatFiles.push({name:f.name,path:f.path});
    }
  }

  await fetchFolder('');
  fuse=new Fuse(flatFiles,{keys:['name','path'],threshold:0.3,ignoreLocation:true});
  container.innerHTML='Loaded';
}

function performSearch(query){
  const resultsDiv=document.getElementById('resultsList');
  if(!query){ resultsDiv.innerHTML=''; return; }
  const results=fuse.search(query).map(r=>r.item);
  resultsDiv.innerHTML='';
  results.forEach(f=>{
    const div=document.createElement('div'); div.className='result';
    div.innerHTML=`<div class="r-left">ðŸ“„</div>
      <div class="r-body">
        <div class="r-name">${f.name}</div>
        <div class="r-path">${f.path}</div>
      </div>`;
    div.addEventListener('click',()=>previewFile(f));
    resultsDiv.appendChild(div);
  });
}

async function previewFile(f){
  document.getElementById('previewTitle').innerText=f.name;
  document.getElementById('previewPath').innerText=f.path;
  document.getElementById('openRaw').style.display='inline-block';
  document.getElementById('openRaw').onclick=()=>window.open(`https://raw.githubusercontent.com/${owner}/${repo}/main/${f.path}`);
  const previewContent=document.getElementById('previewContent');
  previewContent.innerHTML='Loadingâ€¦';
  try{
    const res=await authFetch(`${contentsBase}/${encodeURIComponent(f.path)}`);
    const data=await res.json();
    const content=atob(data.content.replace(/\n/g,''));
    if(f.name.endsWith('.md')) previewContent.innerHTML=marked.parse(content);
    else previewContent.innerHTML=`<pre><code>${content.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</code></pre>`;
    hljs.highlightAll();
  }catch(e){ previewContent.innerHTML='Error fetching file.'; }
}

document.getElementById('globalSearch').addEventListener('input', e=>performSearch(e.target.value));
document.getElementById('clearSearch').addEventListener('click', ()=>{
  document.getElementById('globalSearch').value='';
  performSearch('');
});
document.getElementById('refreshBtn').addEventListener('click', loadRepoRecursive);

loadRepoRecursive();
</script>
</body>
</html>
